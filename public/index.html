<!DOCTYPE html>
<html>
<head>
  <title>BUY / SELL / HOLD</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    .hero {
      background-color: #0066cc;
      color: white;
      padding: 20px;
      margin: -20px -20px 20px -20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .hero h1 {
      margin: 0;
      font-size: 24px;
      color: white;
    }
    .auth-links {
      display: flex;
      gap: 15px;
    }
    .auth-links a {
      color: white;
      text-decoration: none;
      padding: 8px 16px;
      border: 1px solid white;
      border-radius: 4px;
      font-size: 14px;
    }
    .auth-links a:hover {
      background-color: white;
      color: #0066cc;
    }
    .container {
      background-color: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      text-align: center;
      margin-bottom: 10px;
    }
    h2 {
      color: #666;
      text-align: center;
      margin-top: 0;
      margin-bottom: 30px;
      font-size: 1.2em;
      font-weight: normal;
      text-transform: uppercase;
    }
    .input-group {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    input[type="text"] {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    button {
      padding: 12px 24px;
      background-color: #0066cc;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin: 5px;
    }
    button:hover {
      background-color: #0052a3;
    }
    button:disabled {
      background-color: #cccccc;
      cursor: not-allowed;
    }
    #result {
      margin-top: 20px;
      padding: 20px;
      border-radius: 4px;
      display: none;
    }
    .success {
      background-color: #e6ffe6;
      border: 1px solid #00cc00;
    }
    .error {
      background-color: #ffe6e6;
      border: 1px solid #cc0000;
    }
    .button-group {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    #analysis {
      margin-top: 20px;
      padding: 20px;
      border-radius: 4px;
      display: none;
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      white-space: pre-wrap;
    }
    .price-info {
      margin-top: 15px;
      padding: 10px;
      background-color: #f0f8ff;
      border-radius: 4px;
      border: 1px solid #b0c4de;
    }
    .price-info p {
      margin: 5px 0;
      font-size: 14px;
    }
    .price-change {
      font-weight: bold;
    }
    .price-up {
      color: #008000;
    }
    .price-down {
      color: #cc0000;
    }
    .disclaimer {
      margin-top: 40px;
      padding: 15px;
      font-size: 12px;
      color: #666;
      text-align: center;
      border-top: 1px solid #ddd;
      line-height: 1.4;
    }
  </style>
</head>
<body>
  <div class="hero">
    <h1>AI Investor Insights</h1>
    <div class="auth-links">
      <a href="#">Login</a>
      <a href="#">Sign Up</a>
    </div>
  </div>
  <div class="container">
    <h1>BUY / SELL / HOLD</h1>
    <h2>AI analysis of latest quarterly filing</h2>
    <div class="input-group">
      <input type="text" id="symbol" placeholder="Enter stock symbol (e.g., AAPL)" required>
      <div class="button-group">
        <button onclick="fetchData()">Download Latest Quarterly Report</button>
        <button onclick="analyzeData()" id="analyzeBtn" disabled>Analyze Financials</button>
      </div>
    </div>
    <div id="result"></div>
    <div id="priceInfo" class="price-info" style="display: none;"></div>
    <div id="analysis"></div>
    <div class="disclaimer">
      The insights and recommendations provided on this page are generated using AI and are intended for informational purposes only. They do not constitute financial advice. Always conduct your own research or consult with a licensed financial advisor before making investment decisions. Use at your own discretion and risk.
    </div>
  </div>

  <script>
    async function fetchData() {
      const symbol = document.getElementById('symbol').value.toUpperCase();
      const resultDiv = document.getElementById('result');
      const priceInfoDiv = document.getElementById('priceInfo');
      const analyzeBtn = document.getElementById('analyzeBtn');
      const analysisDiv = document.getElementById('analysis');
      
      if (!symbol) {
        showResult('Please enter a stock symbol', 'error');
        return;
      }

      // Clear previous analysis
      analysisDiv.style.display = 'none';
      analysisDiv.innerHTML = '';
      analyzeBtn.disabled = true;

      try {
        const response = await fetch('/fetch', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ symbol: symbol })
        });

        const data = await response.json();
        
        if (response.ok) {
          showResult(data.message, 'success');
          analyzeBtn.disabled = false;
          // Display price information
          if (data.filingPrice && data.currentPrice) {
            const priceChange = ((data.currentPrice - data.filingPrice) / data.filingPrice * 100).toFixed(2);
            const priceChangeClass = priceChange >= 0 ? 'price-up' : 'price-down';
            const priceChangeSymbol = priceChange >= 0 ? '↑' : '↓';
            
            priceInfoDiv.innerHTML = `
              <p>Filing Date: ${new Date(data.filingDate).toLocaleDateString()}</p>
              <p>Price at Filing: $${data.filingPrice.toFixed(2)}</p>
              <p>Current Price: $${data.currentPrice.toFixed(2)}</p>
              <p class="price-change ${priceChangeClass}">
                Change: ${priceChangeSymbol} ${Math.abs(priceChange)}%
              </p>
            `;
            priceInfoDiv.style.display = 'block';
          }
        } else {
          showResult(data.error || 'An error occurred', 'error');
          analyzeBtn.disabled = true;
          priceInfoDiv.style.display = 'none';
        }
      } catch (error) {
        showResult('Error: ' + error.message, 'error');
        analyzeBtn.disabled = true;
        priceInfoDiv.style.display = 'none';
      }
    }

    async function analyzeData() {
      const symbol = document.getElementById('symbol').value.toUpperCase();
      const analysisDiv = document.getElementById('analysis');
      const analyzeBtn = document.getElementById('analyzeBtn');
      
      if (!symbol) {
        showResult('Please enter a stock symbol', 'error');
        return;
      }

      analyzeBtn.disabled = true;
      analysisDiv.style.display = 'block';
      analysisDiv.innerHTML = 'Analyzing financial data...';

      try {
        const response = await fetch('/analyze', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ symbol: symbol })
        });

        const data = await response.json();
        
        if (response.ok) {
          const filingDate = document.querySelector('#priceInfo p:first-child').textContent.split(': ')[1];
          analysisDiv.innerHTML = `<h3>Financial analysis based on last quarterly report filed on ${filingDate}</h3>${data.analysis}`;
        } else {
          analysisDiv.innerHTML = `Error: ${data.error}`;
        }
      } catch (error) {
        analysisDiv.innerHTML = `Error: ${error.message}`;
      } finally {
        analyzeBtn.disabled = false;
      }
    }

    function showResult(message, type) {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = message;
      resultDiv.style.display = 'block';
      resultDiv.className = type;
    }
  </script>
</body>
</html>
