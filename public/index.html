<!DOCTYPE html>
<html>
<head>
  <title>BUY / SELL / HOLD</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="hero">
    <div class="hero-content">
      <h1>AI Investor Insights</h1>
      <div class="auth-links">
        <a href="#">Login</a>
        <a href="#">Sign Up</a>
      </div>
    </div>
  </div>
  
  <div class="main-content">
    <div class="container">
      <h1>BUY / SELL / HOLD</h1>
      <h2>AI analysis of latest quarterly filing</h2>
      <div class="input-group">
        <input type="text" id="symbol" placeholder="Enter stock symbol (e.g., AAPL)" required>
        <div class="button-group">
          <button onclick="fetchData()">Download Latest Quarterly Report</button>
          <button onclick="analyzeData()" id="analyzeBtn" disabled>Analyze Financials</button>
        </div>
      </div>
      <div id="result"></div>
      <div id="priceInfo" class="price-info" style="display: none;"></div>
      <div id="analysis"></div>
      <div class="disclaimer">
        The insights and recommendations provided on this page are generated using AI and are intended for informational purposes only. They do not constitute financial advice. Always conduct your own research or consult with a licensed financial advisor before making investment decisions. Use at your own discretion and risk.
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-content">
      <p>© 2024 AI Investor Insights. All rights reserved.</p>
      <p>
        <a href="#">Privacy Policy</a> | 
        <a href="#">Terms of Service</a> | 
        <a href="#">Contact Us</a>
      </p>
    </div>
  </footer>

  <script>
    async function fetchData() {
      const symbol = document.getElementById('symbol').value.toUpperCase();
      const resultDiv = document.getElementById('result');
      const priceInfoDiv = document.getElementById('priceInfo');
      const analyzeBtn = document.getElementById('analyzeBtn');
      const analysisDiv = document.getElementById('analysis');
      
      if (!symbol) {
        showResult('Please enter a stock symbol', 'error');
        return;
      }

      // Clear previous analysis
      analysisDiv.style.display = 'none';
      analysisDiv.innerHTML = '';
      analyzeBtn.disabled = true;

      try {
        const response = await fetch('/fetch', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ symbol: symbol })
        });

        const data = await response.json();
        
        if (response.ok) {
          showResult(data.message, 'success');
          analyzeBtn.disabled = false;
          // Display price information
          if (data.filingPrice && data.currentPrice) {
            const priceChange = ((data.currentPrice - data.filingPrice) / data.filingPrice * 100).toFixed(2);
            const priceChangeClass = priceChange >= 0 ? 'price-up' : 'price-down';
            const priceChangeSymbol = priceChange >= 0 ? '↑' : '↓';
            
            priceInfoDiv.innerHTML = `
              <p>Filing Date: ${new Date(data.filingDate).toLocaleDateString()}</p>
              <p>Price at Filing: $${data.filingPrice.toFixed(2)}</p>
              <p>Current Price: $${data.currentPrice.toFixed(2)}</p>
              <p class="price-change ${priceChangeClass}">
                Change: ${priceChangeSymbol} ${Math.abs(priceChange)}%
              </p>
            `;
            priceInfoDiv.style.display = 'block';
          }
        } else {
          showResult(data.error || 'An error occurred', 'error');
          analyzeBtn.disabled = true;
          priceInfoDiv.style.display = 'none';
        }
      } catch (error) {
        showResult('Error: ' + error.message, 'error');
        analyzeBtn.disabled = true;
        priceInfoDiv.style.display = 'none';
      }
    }

    async function analyzeData() {
      const symbol = document.getElementById('symbol').value.toUpperCase();
      const analysisDiv = document.getElementById('analysis');
      const analyzeBtn = document.getElementById('analyzeBtn');
      
      if (!symbol) {
        showResult('Please enter a stock symbol', 'error');
        return;
      }

      analyzeBtn.disabled = true;
      analysisDiv.style.display = 'block';
      analysisDiv.innerHTML = 'Analyzing financial data...';

      try {
        const response = await fetch('/analyze', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ symbol: symbol })
        });

        const data = await response.json();
        
        if (response.ok) {
          const filingDate = document.querySelector('#priceInfo p:first-child').textContent.split(': ')[1];
          analysisDiv.innerHTML = `<h3>Financial analysis based on last quarterly report filed on ${filingDate}</h3>${data.analysis}`;
        } else {
          analysisDiv.innerHTML = `Error: ${data.error}`;
        }
      } catch (error) {
        analysisDiv.innerHTML = `Error: ${error.message}`;
      } finally {
        analyzeBtn.disabled = false;
      }
    }

    function showResult(message, type) {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = message;
      resultDiv.style.display = 'block';
      resultDiv.className = type;
    }
  </script>
</body>
</html>
